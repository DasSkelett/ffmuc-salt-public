{%- set priv_key = salt.file.read('/etc/wireguard/keys/server-priv.key') %}
{%- set pub_key = salt.file.read('/etc/wireguard/keys/client-' ~ client_name ~  '-pub.key') %}

{% set port = 51820 + interfaces[interface]['ipaddresses'][0]['address'].split('.')[3]| regex_replace('/31','') | int  %}

# Generated by Saltstack 

[Interface]
PrivateKey = {{ priv_key }}
ListenPort = {{ port }}

[Peer]
PublicKey = {{ pub_key }}
AllowedIPs = {{ interfaces[interface]['ipaddresses'][0]['address'] }}, 172.20.0.0/15, {{ interfaces[interface]['ipaddresses'][1]['address'] }}, 2001:608:a01:200::/56